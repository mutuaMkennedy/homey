{% extends 'base.html' %}
{% load static %}
{%load cloudinary %}
{% block head_title %} <title>My account | Rehgien</title>{% endblock %}
{% block content %}
{% load leaflet_tags %}
{% leaflet_js plugins="forms" %}
{% leaflet_css plugins="forms" %}
{% load crispy_forms_tags%}

<section>
  <div id="pfl-pg-cont" class="container">
    <div id="upfPageAcScs" class="_upfPageAcScs">
    </div>
    <div id="upfPageAcErr" class="_upfPageAcErr">
    </div>
    <div id="pfl-page-row">
        <div id="acct_left_navg" data-isOpen='True' class="pfl-page-Sc-1" >
            <div class="ptfl-page-Sc-Overlay">
              <div class="pfl-acct-ElBox">
                  <div id="kdaIPOb_OXpimg">
                    {% include 'profiles/account_details_section.html'%}
                  </div>
                  <div class="pfl-acct-BtnsWrps">
                      <div class="pfl-acct-actionBtnsWrp">
                          <div id="AcsNavLinks" class="pfl-acct-actionBtns tourStep1">
                                <a href="{% url 'homepage'%}" class="tourStep2">
                                  <span class="material-icons">home</span>&nbsp &nbsp
                                  <p>Home</p>
                                </a>
                                <!-- <a href="#" class="dashboardTabLink">
                                  <span class="material-icons">dashboard</span>&nbsp &nbsp
                                  <p>Dashboard</p>
                                </a> -->
                                <a href="#"  id="defaultOpen" data-sc='Account' class="dashboardTabLink tourStep3" onclick="openPage(event, '_dashbordAccount')">
                                  <span class="material-icons">account_circle</span>&nbsp &nbsp
                                  <p>Account</p>
                                </a>
                                <a id="lstSct" href="#" data-sc='Listings' class="dashboardTabLink tourStep4" onclick="openPage(event, '_dashbordListings')">
                                  <span class="material-icons">list_alt</span>&nbsp &nbsp
                                  <p>Listings</p>
                                </a>
                                <a href="{% url 'rehgien_pro:rehgien_pro_homepage'%}" class="dashboardTabLink tourStep5">
                                  <span class="material-icons">business_center</span>&nbsp &nbsp
                                  <p>Rehgien Pro</p>
                                </a>
                          </div>
                      </div>
                  </div>
              </div>
            </div>
        </div>
        <div id="acct_right_content" class="pfl-d">
          <div class="pfl-acct-stg">
              <div class="profileDashHeader">
                  <div class='pflDashHdLeft'>
                    <div class="_uAcc_logo">
                      <button id="upNav-control" type="button" name="button"><span class='material-icons'>dehaze</span></button>
                      &nbsp &nbsp
                      <a href="{% url 'homepage'%}">
                        <img src="{% static 'img/rehgien_logo_r.png' %}" alt="rehgien-logo">
                      </a>
                    </div>
                  </div>
                  <div class="pflDashHdRight">
                      <div id="ntfSction" data-sc='Accounts' class="notificationsTab tourStep6">
                        <a href="{% url 'profiles:notifications'%}"><span class="material-icons">group</span></a>
                        <a href="{% url 'profiles:notifications'%}"><span class="material-icons">notifications</span></a>
                      </div>
                      <div id="acctGreet_odsyb">
                          {% include 'profiles/account_greet.html'%}
                      </div>
                  </div>
              </div>
          </div>
          <div id="_dashbordAccount" class="_dashboardTabContent">
            <h1>Your account <sup>{{user.user_type}}</sup></h1>
            <div class="_AccountovDbox">
              <div class="_accCardsWrapper">
                  <div class="_accCardsWrapperL">
                    <div id="psnalActSction" data-sc='Accounts' class="card _accCard tourStep7">
                        <h3><span class="material-icons">person</span>Profile</h3>

                        <div class="_userProfileMiddle">
                              <div class="_userProfileImgNw">
                                <div id="_PcntComplSc_opsnc">
                                  {% include 'profiles/account_completion_section.html'%}
                                </div>
                                <div class="_userProfileEnd">
                                  <a href="#e-profile-Modal" class="modal-trigger"><button type="button" name="button">Update account</button></a>
                                </div>
                              </div>
                        </div>
                    </div>
                    {% if request.user.user_type == 'PRO'%}
                      <div id="bsNActSction" data-sc='Accounts' class="card _accCard tourStep8">
                        {% if user.user_type != 'PRO' %}
                        <div class="disabledCardOverlay">
                          <div class="_diabledHelperTxt">
                              Pro feature! <br>
                              If you are a pro please request an upgrade!<br>
                              <button type="button" name="button">Request Upgrade</button>
                              <a href="#"><u>Learn more about pros</u></a> <br>
                          </div>
                        </div>
                        {%endif%}
                          <h3><span class="material-icons">assignment_ind</span>Business Profile</h3>
                          <div class="_bsProfileMiddle">
                              <div id="_bspProgress">
                                <div class="_bsProfileCompletion">
                                  <h5>
                                    {% if user.user_type == 'PRO'%}
                                      {{user.pro_business_profile.percentage_complete}}
                                    {% else %}
                                      0
                                    {% endif %}
                                    <sup>%</sup>
                                  </h5>
                                  <h6>Complete</h6>
                                </div>
                              </div>
                              {% if user.pro_business_profile %}
                                <a href="{{user.pro_business_profile.get_absolute_url}}">
                                  <h5>Go to business page &nbsp<span class="material-icons">east</span></h5>
                                </a>
                              {% endif %}
                          </div>
                          <div class="_userProfileEnd">
                            {% if user.user_type == 'PRO' %}
                                {% if user.pro_business_profile %}
                                <a href="{% url 'profiles:pro_business_page_edit' user.pro_business_profile.pk %}" class="modal-trigger">
                                  <button type="button" name="button">Update Business Profile</button>
                                </a>
                                {% else %}
                                <a href="#"><button type="button" name="button">No Business Profile</button></a>
                                {% endif %}
                            {% endif %}


                          </div>
                      </div>
                    {% endif %}
                  </div>
                  <div class="_accCardsWrapperR">
                    <div class="_accCardsWrapScal">
                      {% if request.user.user_type == 'PRO'%}
                      <div id="ConSSction" data-sc='Accounts' class="card _accCard tourStep9">
                        {% if request.user.user_type != 'PRO' %}
                        <div class="disabledCardOverlay">
                          <div class="_diabledHelperTxt">
                              Pro feature! <br>
                              If you are a pro please request an upgrade! <br>
                              <button type="button" name="button">Request Upgrade</button>
                              <a href="#"><u>Learn more about pros</u></a> <br>
                          </div>
                        </div>
                        {%endif%}
                          <h3><span class="material-icons">groups</span>Connections</h3>
                          <div class="_bsProfileMiddle">
                                <div class="_userConnections">
                                  <h5>{{pro_connections.count}}</h5>
                                  <h6>Connections</h6>
                                </div>
                                <div class="_userConnectionsAvatars">
                                  {% if pro_connections %}
                                    {% for connection in pro_connections|slice:":3"%}
                                      {% if user == connection.requestor %}
                                        <div class="_userCAvImg{{forloop.counter}}">
                                          <img src="
                                          {% if connection.receiver.profile_image %}
                                            {{connection.receiver.profile_image.url}}
                                          {% else %}
                                            {%static 'img/avatar.png'%}
                                          {% endif %}
                                          " alt="avatar">
                                        </div>
                                      {% elif user == connection.receiver %}
                                        <div class="_userCAvImg{{forloop.counter}}">
                                          <img src="
                                          {% if connection.requestor.profile_image %}
                                            {{connection.requestor.profile_image.url}}
                                          {% else %}
                                            {%static 'img/avatar.png'%}
                                          {% endif %}
                                          " alt="avatar">
                                        </div>
                                      {% endif %}
                                    {%endfor%}
                                    {% if pro_connections|length > 3 %}
                                      <div class="_userCAvImgExtra">
                                        +{{ pro_connections|length|add:"-3" }} <span>more</span>
                                      </div>
                                    {% else %}
                                      <div class="_userCAvImgExtra">

                                      </div>
                                    {% endif %}
                                  {%endif%}
                                </div>
                          </div>
                          <div class="_userProfileEnd">
                            <a {% if request.user.user_type == 'PRO' %} href="{% url 'profiles:user_connections'%}" {% endif %}><button type="button" name="button">Manage Connections</button></a>
                          </div>
                      </div>
                      {% endif %}
                      <div id="ConSSction" data-sc='Accounts' class="card _accCard tourStep10">
                          <h3><span class="material-icons">how_to_reg</span>
                            {% if user.user_type == 'CLIENT' %}<!-- Use following instead of followers -->
                              Following
                            {% else %}
                              Followers
                            {% endif %}
                          </h3>

                          <div class="_bsProfileMiddle">
                            {% if request.user.user_type == 'CLIENT'%} <!-- Use following instead of followers -->
                                <div class="_userConnections">
                                    <h5>
                                      {{following|length}}
                                    </h5>
                                    <h6>Following</h6>
                                </div>
                                <div class="_userConnectionsAvatars">
                                      {% if following %}
                                          {% for following in following %}
                                            <div class="_userCAvImg{{forloop.counter}}">
                                              <img src="
                                                {% if following.profile_image %}
                                                  {{following.profile_image.url}}
                                                {% else %}
                                                  {%static 'img/avatar.png'%}
                                                {% endif %}
                                              " alt="avatar">
                                            </div>
                                          {% endfor %}
                                          {% if following|length > 3 %}
                                            <div class="_userCAvImgExtra">
                                              +{{ following|length|add:"-3" }} <span>more</span>
                                            </div>
                                          {% else %}
                                            <div class="_userCAvImgExtra">
                                            </div>
                                          {% endif %}
                                    {% endif %}
                                </div>
                            {% else %}
                                <div class="_userConnections">
                                    <h5>{{user.pro_business_profile.followers.all.count}}</h5>
                                    <h6>Followers</h6>
                                </div>
                                <div class="_userConnectionsAvatars">
                                      {% if user.pro_business_profile.followers%}
                                          {% for follower in user.pro_business_profile.followers.all %}
                                            <div class="_userCAvImg{{forloop.counter}}">
                                              <img src="
                                                {% if follower.profile_image %}
                                                  {{follower.profile_image.url}}
                                                {% else %}
                                                  {%static 'img/avatar.png'%}
                                                {% endif %}
                                              " alt="avatar">
                                            </div>
                                          {% endfor %}
                                          {% if user.pro_business_profile.followers|length > 3 %}
                                            <div class="_userCAvImgExtra">
                                              +{{ user.pro_business_profile.followers|length|add:"-3" }} <span>more</span>
                                            </div>
                                          {% else %}
                                            <div class="_userCAvImgExtra">
                                            </div>
                                          {% endif %}
                                  {% endif %}
                                </div>
                            {% endif %}
                          </div>
                          <div class="_userProfileEnd">
                            <a href="{% url 'profiles:user_followers' %}"><button type="button" name="button">Manage Followers</button></a>
                          </div>
                      </div>
                    </div>
                    {% comment 'Not fully supported yet '%}
                    <div id="_activityAccCard" class="card _accCard">
                        <h3><span class="material-icons">timeline</span>Activity Log</h3>

                        <div class="_accActivityMiddle">
                              <div class="_accActivityCard card">
                                  <h3>1 august 2020</h3>
                                  <div class="_accAcCardBody">
                                    <div class="_accAcCardUserDtls">
                                      <img src="{%static 'img/av2.jpg'%}" alt="avatar">
                                      <h4>rehgienAdmin (You)</h4>
                                    </div>
                                    <div class="_accAccDesc">
                                      Created a new property Listing
                                    </div>
                                  </div>
                              </div>
                              <div class="_accActivityCard card">
                                  <h3>1 august 2020</h3>
                                  <div class="_accAcCardBody">
                                    <div class="_accAcCardUserDtls">
                                      <img src="{%static 'img/av2.jpg'%}" alt="avatar">
                                      <h4>rehgienAdmin (You)</h4>
                                    </div>
                                    <div class="_accAccDesc">
                                      Created a new property Listing
                                    </div>
                                  </div>
                              </div>
                              <div class="_accActivityCard card">
                                  <h3>1 august 2020</h3>
                                  <div class="_accAcCardBody">
                                    <div class="_accAcCardUserDtls">
                                      <img src="{%static 'img/av4.jpg'%}" alt="avatar">
                                      <h4>rehgienAdmin (You)</h4>
                                    </div>
                                    <div class="_accAccDesc">
                                      Saved a property Listing
                                    </div>
                                  </div>
                              </div>
                              <div class="_accActivityCard card">
                                  <h3>1 august 2020</h3>
                                  <div class="_accAcCardBody">
                                    <div class="_accAcCardUserDtls">
                                      <img src="{%static 'img/av1.jpg'%}" alt="avatar">
                                      <h4>rehgienAdmin (You)</h4>
                                    </div>
                                    <div class="_accAccDesc">
                                      Followed an agent
                                    </div>
                                  </div>
                              </div>
                              <div class="_accActivityCard card">
                                  <h3>1 august 2020</h3>
                                  <div class="_accAcCardBody">
                                    <div class="_accAcCardUserDtls">
                                      <img src="{%static 'img/av3.jpg'%}" alt="avatar">
                                      <h4>rehgienAdmin (You)</h4>
                                    </div>
                                    <div class="_accAccDesc">
                                      Created a new property Listing
                                    </div>
                                  </div>
                              </div>
                        </div>
                    </div>
                    {% endcomment %}
                  </div>
                    {% comment 'Not fully supported yet '%}
                      <div class="_accSgCardsWrapper">
                        <div class="card _accSgCard">
                            <h3><span class="material-icons">admin_panel_settings</span>Sign in & Security</h3>
                            <div class="_accSgCardMiddle">
                              <p>Manage your sign in options, security options and passwords.</p>
                            </div>
                            <div class="_accSgCardEnd">
                              <a href="#" class="modal-trigger"><button type="button" name="button">Manage Options</button></a>
                            </div>
                        </div>
                        <div class="card _accSgCard">
                            <h3><span class="material-icons">settings</span>Privacy & Account settings</h3>
                            <div class="_accSgCardMiddle">
                                <p>Deactivate your account or manage your privacy settings. </p>
                            </div>
                            <div class="_accSgCardEnd">
                              <a href="#" class="modal-trigger"><button type="button" name="button">Manage Settings</button></a>
                            </div>
                        </div>
                      </div>
                    {% endcomment %}
              </div>
            </div>
          </div>
          <div id="_dashbordListings" class="_dashboardTabContent">
              <div  id="pfl-d-sw">
                <ul id="pfl-pg-switch" data-sc='Listings'class="tabs tourStep11">
                    {% if user.pro_business_profile.professional_category.professional_group.slug == 'real-estate-services'%}
                    <li id="propLink_ls" data-sc='Listings' class="tab col s3 tourStep12"><a href="#_dashMyListings">Property</a></li>
                    {% endif %}
                      <li id="propSvLink_ls" data-sc='Listings' class="tab col s3 tourStep13"><a href="#_dashMyFavs">Saved Property</a></li>
                    <li id="propJbpLink_ls" data-sc='Listings' class="tab col s3 tourStep14"><a href="#_dashRequests">Job Posts</a></li>
                    {% if user.user_type == 'PRO'%}
                      <li id="propPtfLink_ls" data-sc='Listings' class="tab col s3 tourStep15"><a href="#_dashMyPortfolio">Portfolio</a></li>
                    {% endif %}
                </ul>
              </div>
              <div class="pfl-dtl">
                {% if user.pro_business_profile.professional_category.professional_group.slug == 'real-estate-services'%}
                <div id="_dashMyListings" class="pfl-listings pfl_itemsSection_post">
                    {% if user.pro_business_profile.professional_category.professional_group.slug == 'real-estate-services'%}
                      <div  id="MyListingsSwWr">
                        <ul id="MyListings-switch" class="tabs">
                            <li class="tab col s3"><a href="#MySaleListings">For sale</a></li>
                            <li class="tab col s3"><a href="#MyRentalListings">For Rent</a></li>
                        </ul>
                      </div>
                      <div id="MySaleListings">
                        <div class="MyLsgHd">
                          <p>My Properties <span>Showing {{user_sale_posts.count}} results</span></p>
                          <a href="{% url 'listings:property_listing_form'%}"><button type="button" name="button"><span class="material-icons">add</span>Post new property</button></a>
                        </div>
                          <div class="profile-sale">
                                  {% if user_sale_posts%}
                                    <div id="pfl-sal">
                                      <table>
                                        <thead>
                                          <tr>
                                            <th>Property</th>
                                            <th>Leads</th>
                                            <th>Stats</th>
                                            <th>Posted on</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                          </tr>
                                        </thead>
                                        {% for onsale_listings in user_sale_posts %}
                                          <tr>
                                              <td>
                                                  <div id="rec-card" class="card">
                                                  <div id="rec-img" class="card-image">
                                                    <a href="{{onsale_listings.get_absolute_url}}">
                                                      {% for home_photo in onsale_listings.home_photos.all %}
                                                        {% if forloop.last %}
                                                          {% cloudinary home_photo.photo ImageTransformation %}
                                                        {% endif %}
                                                      {% endfor %}
                                                  </a>
                                                  </div>
                                                  <div id="rec-content" class="card-content">
                                                    <ol>
                                                      <li class="rec-h-name">{{onsale_listings.property_name}}</li>
                                                      <li class="rec-h-location">{{onsale_listings.location_name}}</li>
                                                      <li class="rec-h-features">{{onsale_listings.bathrooms}} ba| {{onsale_listings.bedrooms}} bds| {{onsale_listings.floor_area}} {{onsale_listings.size_units}}</li>
                                                      <li class="rec-h-price">Ksh: {{onsale_listings.price}}</li>
                                                    </ol>
                                                  </div>
                                                  </div>
                                              </td>
                                              <td>
                                                <div class="_dashlistingLeads">

                                                  {{onsale_listings.all_leads.count}} till now
                                                  <div class="_dashLsgLdUsers">
                                                     {% for lead in onsale_listings.all_leads %}
                                                        <div class="_dashLsgLdUserImg{{forloop.counter}}">
                                                          <img src="
                                                            {% if lead.user.profile_image %}
                                                              {{lead.user.profile_image.url}}
                                                            {% else %}
                                                              {% static 'img/avatar.png'%}
                                                            {% endif %}
                                                          " alt="">
                                                        </div>
                                                      {%endfor%}
                                                      {% if onsale_listings.all_leads.count > 4 %}
                                                        <div class="_dashLsgLdUserExtra">
                                                          +{{ onsale_listings.all_leads.count|add:"-4" }}
                                                        </div>
                                                      {% else %}
                                                        <div class="_dashLsgLdUserExtra">
                                                          +0
                                                        </div>
                                                      {% endif %}

                                                  </div>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="_dashLsgAcStats">
                                                  {% if onsale_listings.views_trend > 0 %}
                                                    <span class="material-icons">trending_up</span>
                                                  {% else %}
                                                    <span class="material-icons">trending_flat</span>
                                                  {% endif %}
                                                    <div class="_dashLsgAcStd">
                                                      <h4>{{onsale_listings.total_views_count}} &nbsp + &nbsp<span>{{onsale_listings.recent_views_count}}</span></h4>
                                                      <h5>Total Views</h5>
                                                    </div>
                                                </div>
                                              </td>
                                              <td>
                                                <span id="rec-date" class="card-title"><p>{{onsale_listings.publishdate.date}}</p></span>
                                              </td>
                                              <td>
                                                <div class="_dashLsgAcStatus">
                                                    {% if onsale_listings.is_active %}
                                                      <span>Active</span>
                                                      Till {{onsale_listings.active_until|date}}
                                                    {% else %}
                                                      <span>Inactive</span>
                                                      From {{onsale_listings.publishdate|date}}
                                                    {% endif %}
                                                </div>
                                              </td>
                                              <td>
                                                <div class="card-links">
                                                    <a href="{% url 'listings:property_update' property_category=onsale_listings.property_category|lower pk=onsale_listings.pk%}"><button id="link-edit" type="button" name="button">
                                                      <span class="material-icons" style="color:#1100ff">mode_edit</span>
                                                    </button></a>
                                                    <form action="{% url 'listings:property_delete' property_category=onsale_listings.property_category|lower pk=onsale_listings.pk%}" method="post">
                                                      {% csrf_token %}
                                                      <button id="link-del" type="submit" name="button">
                                                        <span class="material-icons" style="color:#ff0000">delete_forever</span>
                                                      </button>
                                                    </form>
                                                </div>
                                              </td>
                                          </tr>
                                        {% endfor %}
                                      </table>
                                    </div>
                                  {% else %}
                                    <div class="empty-list">
                                      <p>No active for sale properties. Properties you list will appear here.</p>
                                    </div>
                                  {% endif%}
                          </div>
                      </div>
                      <div id="MyRentalListings">
                        <div class="MyLsgHd">
                          <p>My Properties <span>Showing {{user_sale_posts.count}} results</span></p>
                          <a href="{% url 'listings:property_listing_form'%}"><button type="button" name="button"><span class="material-icons">add</span>Post new property</button></a>
                        </div>
                        <div class="profile-rentals">
                              {% if user_rental_posts%}
                                <div id="pfl-sal">
                                  <table>
                                    <thead>
                                      <tr>
                                        <th>Property</th>
                                        <th>Leads</th>
                                        <th>Stats</th>
                                        <th>Posted on</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                      </tr>
                                    </thead>
                                    {% for rentals in user_rental_posts %}
                                    <tr>
                                        <td>
                                            <div id="rec-card" class="card">
                                            <div id="rec-img" class="card-image">
                                              <a href="{{rentals.get_absolute_url}}">
                                                {% for home_photo in rentals.home_photos.all %}
                                                  {% if forloop.last %}
                                                    {% cloudinary home_photo.photo ImageTransformation %}
                                                  {% endif %}
                                                {% endfor %}
                                            </a>
                                            </div>
                                            <div id="rec-content" class="card-content">
                                              <ol>
                                                <li class="rec-h-name">{{rentals.property_name}}</li>
                                                <li class="rec-h-location">{{rentals.location_name}}</li>
                                                <li class="rec-h-features">{{rentals.bathrooms}} ba| {{rentals.bedrooms}} bds| {{rentals.floor_area}} {{rentals.size_units}}</li>
                                                <li class="rec-h-price">Ksh: {{rentals.price}}</li>
                                              </ol>
                                            </div>
                                            </div>
                                        </td>
                                        <td>
                                          <div class="_dashlistingLeads">
                                            {{rentals.all_leads.count}} till now
                                            <div class="_dashLsgLdUsers">
                                               {% for lead in rentals.all_leads %}
                                                  <div class="_dashLsgLdUserImg{{forloop.counter}}">
                                                    <img src="
                                                      {% if lead.user.profile_image %}
                                                        {{lead.user.profile_image.url}}
                                                      {% else %}
                                                        {% static 'img/avatar.png'%}
                                                      {% endif %}
                                                    " alt="">
                                                  </div>
                                                {%endfor%}
                                                {% if rentals.all_leads.count > 4 %}
                                                  <div class="_dashLsgLdUserExtra">
                                                    +{{ rentals.all_leads.count|add:"-4" }}
                                                  </div>
                                                {% else %}
                                                  <div class="_dashLsgLdUserExtra">
                                                    +0
                                                  </div>
                                                {% endif %}
                                          </div>
                                        </td>
                                        <td>
                                          <div class="_dashLsgAcStats">
                                            {% if rentals.views_trend > 0 %}
                                              <span class="material-icons">trending_up</span>
                                            {% else %}
                                              <span class="material-icons">trending_flat</span>
                                            {% endif %}
                                              <div class="_dashLsgAcStd">
                                                <h4>{{rentals.total_views_count}} &nbsp + &nbsp<span>{{rentals.recent_views_count}}</span></h4>
                                                <h5>Total Views</h5>
                                              </div>
                                          </div>
                                        </td>
                                        <td>
                                          <span id="rec-date" class="card-title"><p>{{rentals.publishdate.date}}</p></span>
                                        </td>
                                        <td>
                                          <div class="_dashLsgAcStatus">
                                            {% if rentals.is_active %}
                                              <span>Active</span>
                                              Till {{rentals.active_until|date}}
                                            {% else %}
                                              <span>Inactive</span>
                                              From {{rentals.publishdate|date}}
                                            {% endif %}
                                          </div>
                                        </td>
                                        <td>
                                          <div class="card-links">
                                            <a href="{% url 'listings:property_update' property_category=rentals.property_category|lower pk=rentals.pk%}"><button id="link-edit" type="button" name="button">
                                            <span class="material-icons" style="color:#1100ff">mode_edit</span>
                                            </button></a>
                                            <form action="{% url 'listings:property_delete' property_category=rentals.property_category|lower pk=rentals.pk%}" method="post">
                                              {% csrf_token %}
                                              <button id="link-del" type="submit" name="button"><span class="material-icons" style="color:#ff0000">delete_forever</span></button>
                                            </form>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                  </table>
                                </div>
                              {% else %}
                                <div class="empty-list">
                                  <p>No active rental properties. Properties you list will appear here.</p>
                                </div>
                              {%endif%}
                        </div>
                      </div>
                    {% else %}
                      <div class="empty-list">
                        <p>You are not allowed to have property posts.
                          <br> We currently do not allow FSBO properties. To list find a <a href="{% url 'profiles:business_list' %}?p_cat=real-estate-agents" target="_blank"><u>Agent</u></a> or <a href="{% url 'profiles:business_list' %}?p_cat=property-managers" target="_blank"><u>Property Manager</u></a><br>
                           Want to learn more <a href="#"><u>Visit here.</u></a>
                         </p>
                      </div>
                    {% endif %}
                </div>
                {% endif %}
                <div id="_dashMyFavs" class="favourites-sc pfl_itemsSection_post">
                  <div class="pfl-listings">
                      <div  id="MyListingsSwWr">
                        <ul id="MyListings-switch" class="tabs">
                            <li class="tab col s3"><a href="#MyFavSaleListings">For sale</a></li>
                            <li class="tab col s3"><a href="#MyFavRentalListings">For Rent</a></li>
                        </ul>
                      </div>
                      <div id="MyFavSaleListings">
                        <div class="MyLsgHd">
                          <p>Saved Properties <span>Showing {{user_sale_favs.count}} results.</span></p>
                        </div>
                        <div class="profile-sale">
                                {% if user_sale_favs %}
                                <div id="pfl-sal" >
                                    <table>
                                      <thead>
                                        <tr>
                                          <th>Property</th>
                                          <!-- <th>Stats</th> -->
                                          <th>Posted on</th>
                                          <th>Actions</th>
                                        </tr>
                                      </thead>
                                      {% for favs in user_sale_favs %}
                                      <tr id='_isSavedLsUpf_id_{{favs.pk}}'>
                                          <td>
                                              <div id="rec-card" class="card">
                                              <div id="rec-img" class="card-image">
                                                <a href="{{favs.get_absolute_url}}">
                                                  {% for home_photo in favs.home_photos.all %}
                                                    {% if forloop.last %}
                                                      {% cloudinary home_photo.photo ImageTransformation %}
                                                    {% endif %}
                                                  {% endfor %}
                                                </a>
                                              </div>
                                              <div id="rec-content" class="card-content">
                                                <ol>
                                                  <li class="rec-h-name">{{favs.property_name}}</li>
                                                  <li class="rec-h-location">{{favs.location_name}}</li>
                                                  <li class="rec-h-features">{{favs.bathrooms}} ba| {{favs.bedrooms}} bds| {{favs.floor_area}} {{favs.size_units}}</li>
                                                  <li class="rec-h-price">Ksh: {{favs.price}}</li>
                                                </ol>
                                              </div>
                                              </div>
                                          </td>
                                          <!-- <td>
                                            <div class="_dashLsgAcStats">
                                                <span class="material-icons">trending_up</span>
                                                <div class="_dashLsgAcStd">
                                                  <h4>300 &nbsp + &nbsp<span>12</span></h4>
                                                  <h5>Total Saves</h5>
                                                </div>
                                            </div>
                                          </td> -->
                                          <td>
                                            <span id="rec-date" class="card-title"><p>{{favs.publishdate.date}}</p></span>
                                          </td>
                                          <td>
                                            <div class="fav-button">
                                                <button class="_removeSavedlsUpf"  data-propertypk='{{favs.pk}}' type="button" name="button"><i class="material-icons right" style="color:red;">favorite_border</i></button>
                                            </div>
                                          </td>
                                      </tr>
                                      {% endfor %}
                                    </table>
                                </div>
                                {% else %}
                                <div class="empty-list">
                                  <p>No saves. Properties you save will appear here.</p>
                                </div>
                                {% endif%}
                        </div>
                      </div>
                      <div id="MyFavRentalListings">
                        <div class="MyLsgHd">
                          <p>Saved Properties <span>Showing {{user_rental_favs.count}} results.</span></p>
                        </div>
                        <div class="profile-rentals">
                              {% if user_rental_favs %}
                                  <div id="pfl-sal">
                                      <table>
                                        <thead>
                                          <tr>
                                            <th>Property</th>
                                            <!-- <th>Stats</th> -->
                                            <th>Posted on</th>
                                            <th>Actions</th>
                                          </tr>
                                        </thead>
                                        {% for favs in user_rental_favs %}
                                        <tr id='_isSavedLsUpf_id_{{favs.pk}}'>
                                            <td>
                                                <div id="rec-card" class="card">
                                                <div id="rec-img" class="card-image">
                                                  <a href="{{favs.get_absolute_url}}">
                                                    {% for home_photo in favs.home_photos.all %}
                                                      {% if forloop.last %}
                                                        {% cloudinary home_photo.photo ImageTransformation %}
                                                      {% endif %}
                                                    {% endfor %}
                                                  </a>
                                                </div>
                                                <div id="rec-content" class="card-content">
                                                  <ol>
                                                    <li class="rec-h-name">{{favs.property_name}}</li>
                                                    <li class="rec-h-location">{{favs.location_name}}</li>
                                                    <li class="rec-h-features">{{favs.bathrooms}} ba| {{favs.bedrooms}} bds| {{favs.floor_area}} {{favs.size_units}}</li>
                                                    <li class="rec-h-price">Ksh: {{favs.price}} p/m</li>
                                                  </ol>
                                                </div>
                                                </div>
                                            </td>
                                            <!-- <td>
                                              <div class="_dashLsgAcStats">
                                                  <span class="material-icons">trending_up</span>
                                                  <div class="_dashLsgAcStd">
                                                    <h4>300 &nbsp + &nbsp<span>12</span></h4>
                                                    <h5>Total Saves</h5>
                                                  </div>
                                              </div>
                                            </td> -->
                                            <td>
                                              <span id="rec-date" class="card-title"><p>{{favs.publishdate.date}}</p></span>
                                            </td>
                                            <td>
                                              <div class="fav-button">
                                                  <button class="_removeSavedlsUpf" data-propertypk='{{favs.pk}}' type="button" name="button"><i class="material-icons right" style="color:red;">favorite_border</i></button>
                                              </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                      </table>
                                  </div>
                              {% else %}
                              <div class="empty-list">
                                <p>No saves. Properties you save will appear here.</p>
                              </div>
                              {%endif%}
                        </div>
                      </div>
                  </div>
                </div>
                <div id="_dashRequests" class="requests-sc pfl_itemsSection_post">
                      <div  id="MyListingsSwWr">
                        <ul id="MyListings-switch" class="tabs">
                              <li class="tab col s3"><a href="#MyLeadRequests">Posted </a></li>
                          {% if user.user_type == 'PRO' %}
                              <li class="tab col s3"><a href="#MyOtherRequests">Replied to</a></li>
                          {% endif %}
                        </ul>
                      </div>
                      <div id="MyLeadRequests">
                              <div class="MyLsgHd">
                                <p>My job posts <span>Showing {{job_post.count}} results.</span></p>
                                <a href="{% url 'markets:job_post_create'%}"><button type="button" name="button"><span class="material-icons">add</span>Post a job</button></a>
                              </div>
                              <div class="requests-list ler">
                                {% if job_post %}
                                    {% for post in job_post %}
                                      <div class="requestCard card">
                                        <div class="requestCard_body">
                                          <div class="requestCardAcct jbRqstHeader">
                                            <span>
                                              <img src="
                                              {% if post.job_poster.profile_image %}
                                                {{post.job_poster.profile_image.url}}
                                              {% else %}
                                                {% static 'img/avatar.png'%}
                                              {% endif %}
                                              " alt="{{post.job_poster.username}}">
                                              <div class="requestCardDtls">
                                                <h5>{% if post.job_poster.get_full_name %} {{post.job_poster.get_full_name}} {% else %} {{post.job_poster.username}} {% endif %}</h5>
                                                <p>{% if post.job_poster.user_type == 'PRO' %} Rehgien Pro {% else %} Rehgien user {% endif %}</p>
                                              </div>
                                            </span>
                                            <div class="jbRqs_Hd_right">
                                              <div>Project size <span>{{post.project_size|lower}}</span></div>
                                              <div>Project duration <span>{{post.get_project_duration_display|lower}}</span></div>
                                              <div>Job post date <span>{{post.job_update_date.date}}</span></div>
                                            </div>
                                          </div>
                                          <div class="_rqVerified">
                                                {% if post.verified %}
                                                  <h6 class="vrf">
                                                    <span class="material-icons" style="color:#4caf50;">done_all</span>
                                                    Verified
                                                  </h6>
                                                {% else %}
                                                  <h6>
                                                    <span class="material-icons" style="color:#ddd;">done_all</span>
                                                    Unverified
                                                  </h6>
                                                {% endif %}

                                          </div>
                                          <div class="requestCardAcct">
                                              <div class="requestInfoPreVw">
                                                <h6>{{post.title}}</h6>
                                                <div class="rq_ExtgAre">
                                                    <h6>Target areas of expertise include</h6>
                                                    <div class="rq_ExtgAreBtns">
                                                      {% for skill_area in post.skill_areas|slice:':4' %}
                                                        <button>{{skill_area}}</button>
                                                      {% endfor %}
                                                      {% if post.skill_areas|length > 4 %}
                                                        <span>+{{ post.skill_areas|length|add:"-2" }} more</span>
                                                      {% endif%}
                                                    </div>
                                                </div>
                                              </div>
                                          </div>
                                          <div class="requestCardAcct">
                                            <div class="rqInteractions">
                                                <div class="requestClaimsImgW">
                                                  {% if post.job_viewers.all.count != 0 %}
                                                  {% for viewer in post.job_viewers.all|slice:':2' %}
                                                    <div class="requestClaimsImg{{forloop.counter}}">
                                                      <img src="
                                                        {% if viewer.profile_image %}
                                                          {{viewer.profile_image.url}}
                                                        {% else %}
                                                        {%static 'img/avatar.png'%}
                                                        {% endif %}
                                                      " alt="avatar">
                                                    </div>
                                                  {% endfor %}
                                                  {% else %}
                                                      <img src="{%static 'img/avatar.png'%}" alt="">
                                                  {% endif %}
                                                </div>
                                                <div class="_rCrRW">
                                                    <div class="requestClaims">
                                                      {{post.job_viewers.count}}
                                                      <span>Views</span>
                                                    </div>
                                                    <div class="requestReferals">
                                                      {{post.job_post_proposal.count}}
                                                      <span>Proposals</span>
                                                    </div>
                                                </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="requestActionBtns">
                                            <form action="{% url 'markets:job_post_deactivate' post.pk%}" method="post">
                                              {% csrf_token %}
                                              <button type="submit" name="button">
                                                <i class="fas fa-power-off fa-lg"></i>
                                                Turn Off
                                              </button>
                                            </form>
                                          <a href="{% url 'markets:job_post_update' post.pk%}">
                                            <button type="button" name="button">
                                              <i class="far fa-edit fa-lg" ></i>
                                                Update
                                            </button>
                                          </a>
                                          <a href="{% url 'markets:job_post_detail' post.pk%}" target="_blank">
                                            <button type="button" name="button">
                                                View replies
                                            </button>
                                          </a>
                                        </div>
                                      </div>
                                    {% endfor %}
                                {% else %}
                                <div class="empty-list">
                                  <p>You currently dont have any job posts. Your job post will appear here once you have them.</p>
                                </div>
                                {%endif%}
                              </div>
                      </div>
                      {% if user.user_type == 'PRO' %}
                        <div id="MyOtherRequests">
                          <div class="MyLsgHd">
                            <p>Job posts you replied to <span>Showing {{job_post_proposal.count}} results.</span></p>
                          </div>
                          <div class="requests-list oth">
                            {% if my_job_replies %}
                                {% for post in my_job_replies %}
                                <div class="requestCard card">
                                  <div class="requestCard_body">
                                    <div class="requestCardAcct jbRqstHeader">
                                      <span>
                                        <img src="
                                        {% if post.job_post.job_poster.profile_image %}
                                          {{post.job_post.job_poster.profile_image.url}}
                                        {% else %}
                                          {% static 'img/avatar.png'%}
                                        {% endif %}
                                        " alt="{{post.job_post.job_poster.username}}">
                                        <div class="requestCardDtls">
                                          <h5>{% if post.job_post.job_poster.get_full_name %} {{post.job_post.job_poster.get_full_name}} {% else %} {{post.job_post.job_poster.username}} {% endif %}</h5>
                                          <p>{% if post.job_post.job_poster.user_type == 'PRO' %} Rehgien Pro {% else %} Rehgien user {% endif %}</p>
                                        </div>
                                      </span>
                                      <div class="jbRqs_Hd_right">
                                        <div>Project size <span>{{post.job_post.project_size|lower}}</span></div>
                                        <div>Project duration <span>{{post.job_post.get_project_duration_display|lower}}</span></div>
                                        <div>Job post date <span>{{post.job_post.job_update_date.date}}</span></div>
                                      </div>
                                    </div>
                                    <div class="_rqVerified">
                                          {% if post.job_post.verified %}
                                            <h6 class="vrf">
                                              <span class="material-icons" style="color:#4caf50;">done_all</span>
                                              Verified
                                            </h6>
                                          {% else %}
                                            <h6>
                                              <span class="material-icons" style="color:#ddd;">done_all</span>
                                              Unverified
                                            </h6>
                                          {% endif %}

                                    </div>
                                    <div class="requestCardAcct">
                                        <div class="requestInfoPreVw">
                                          <h6>{{post.job_post.title}}</h6>
                                          <div class="rq_ExtgAre">
                                              <h6>Target areas of expertise include</h6>
                                              <div class="rq_ExtgAreBtns">
                                                {% for skill_area in post.job_post.skill_areas|slice:':4' %}
                                                  <button>{{skill_area}}</button>
                                                {% endfor %}
                                                {% if post.job_post.skill_areas|length > 4 %}
                                                  <span>+{{ post.job_post.skill_areas|length|add:"-2" }} more</span>
                                                {% endif%}
                                              </div>
                                          </div>
                                        </div>
                                    </div>
                                    <div class="requestCardAcct">
                                      <div class="rqInteractions">
                                          <div class="requestClaimsImgW">
                                            {% if post.job_post.job_viewers.all.count != 0 %}
                                            {% for viewer in post.job_post.job_viewers.all|slice:':2' %}
                                              <div class="requestClaimsImg{{forloop.counter}}">
                                                <img src="
                                                  {% if viewer.profile_image %}
                                                    {{viewer.profile_image.url}}
                                                  {% else %}
                                                  {%static 'img/avatar.png'%}
                                                  {% endif %}
                                                " alt="avatar">
                                              </div>
                                            {% endfor %}
                                            {% else %}
                                                <img src="{%static 'img/avatar.png'%}" alt="">
                                            {% endif %}
                                          </div>
                                          <div class="_rCrRW">
                                              <div class="requestClaims">
                                                {{post.job_post.job_viewers.count}}
                                                <span>Views</span>
                                              </div>
                                              <div class="requestReferals">
                                                {{post.job_post.job_post_proposal.count}}
                                                <span>Proposals</span>
                                              </div>
                                          </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="requestActionBtns">
                                    <a href="{% url 'rehgien_pro:job_detail' post.job_post.pk %}" target="_blank">
                                      <button type="button" name="button">
                                          View job
                                      </button>
                                    </a>
                                  </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="empty-list">
                                  <p>There are currently no active job posts you have replied to.</p>
                                </div>
                            {%endif%}
                          </div>
                        </div>
                      {% endif %}
                      </div>
                {% if user.user_type == 'PRO'%}
                <div id="_dashMyPortfolio" class="pfl_itemsSection_post">
                  <div  id="MyListingsSwWr">
                    <ul id="MyListings-switch" class="tabs">
                        <li class="tab col s3"><a href="#myPortflioItems">Projects</a></li>
                    </ul>
                  </div>
                  <div id="myPortflioItems">
                      <div class="MyLsgHd">
                        <p>My portfolio items <span>Showing {{portfolio_items.count}} items</span></p>
                        <a href="#c-portfolio-Modal" class="modal-trigger"><button type="button" name="button"><span class="material-icons">add</span>Add new item</button></a>
                      </div>
                      <div class="profile-sale">
                        {% if portfolio_items %}
                          <div id="pfl-sal">
                              <table>
                                <thead>
                                  <tr>
                                    <th>Item</th>
                                    <!-- <th>Stats</th> -->
                                    <th>Posted on</th>
                                    <th>Actions</th>
                                  </tr>
                                </thead>
                                {% for portfolio_item in portfolio_items %}
                                <tr>
                                    <td>
                                        <div id="rec-card" class="card">
                                          <div id="rec-img" class="card-image">
                                            {% for thumb in portfolio_item.portfolio_item_photo.all%}
                                              {% if forloop.last %}
                                                <a href="#">{% cloudinary thumb.photo ImageTransformation %}</a>
                                              {% endif %}
                                            {% endfor %}
                                          </div>
                                          <div id="rec-content" class="card-content">
                                            <ol>
                                              <li class="rec-h-name">{{portfolio_item.name}}</li>
                                            </ol>
                                          </div>
                                        </div>
                                    </td>
                                    <!-- <td>
                                      <div class="_dashLsgAcStats">
                                          <span class="material-icons">trending_up</span>
                                          <div class="_dashLsgAcStd">
                                            <h4>300 &nbsp + &nbsp<span>12</span></h4>
                                            <h5>Total Views</h5>
                                          </div>
                                      </div>
                                    </td> -->
                                    <td>
                                      <span id="rec-date" class="card-title"><p>{{portfolio_item.created_at.date}}</p></span>
                                    </td>
                                    <td>
                                      <div class="card-links">
                                        <a href="#"><button id="link-del" type="button" name="button">
                                          <span class="material-icons" style="color:#ff0000">delete_forever</span>
                                        </button></a>
                                        <!-- <a href="#"><button id="link-edit" type="button" name="button"><i class="far fa-edit fa-lg" style="color:blue"></i></button></a> -->
                                      </div>
                                    </td>
                                </tr>
                                {% endfor %}
                              </table>
                          </div>
                        {% else %}
                          <div class="empty-list">
                            <p>You currently dont have any items in your portfolio list. Items you add will appear here.</p>
                          </div>
                        {% endif %}
                      </div>
                  </div>
                </div>
                {% endif %}
              </div>
          </div>
        </div>
    </div>
  </div>

<div class="fixedGuidedTour tourStep18">
  {% now "j F Y" as todays_date %}
  {% with date_joined=user.date_joined|date:"j F Y"%}
  <button id="showMapTour" class="btn-large cyan {% if date_joined == todays_date %}pulse {%endif%}">
    <i class="large material-icons">help_center</i>
  </button>

  <ul id="introStepMap" class="collapsible">
    <div class="helpCenterHeader">
      <span class="material-icons">help_outline</span>
      <h4>This is your help center for this page. <br> Start or jump to a tutorial on any section if you ever feel lost.</h4>
    </div>
    {% endwith %}
    <li class="active">
      <div class="collapsible-header">
          <div class="guidedScHeader">
            <i class="material-icons">tour</i>Tour this page
          </div>
          <span class="material-icons">expand_more</span>
      </div>
      <div class="collapsible-body">
        <a href="#" data-introStep="1">Start the page tour.</a>
      </div>
    </li>
    <li>
      <div class="collapsible-header">
        <div class="guidedScHeader">
          <i class="material-icons">notifications_active</i>Notifications
        </div>
        <span class="material-icons">expand_more</span>
      </div>
      <div class="collapsible-body"><a href="#" data-introStep="6">Managing notifications</a></div>
    </li>
    <li>
      <div class="collapsible-header">
        <div class="guidedScHeader">
          <i class="material-icons">person</i>Account section
        </div>
        <span class="material-icons">expand_more</span>
      </div>
      <div class="collapsible-body">
        <a href="#" data-introStep="7">What is a Personal profile?</a>
        <a href="#" data-introStep="8">What is a Business profile?</a>
        <a href="#" data-introStep="9">What are connections?</a>
        <a href="#" data-introStep="10">How does the follow/ing section work?</a>
      </div>
    </li>
    <li>
      <div class="collapsible-header">
          <div class="guidedScHeader">
            <i class="material-icons">list_alt</i>Listings section
          </div>
          <span class="material-icons">expand_more</span>
      </div>
      <div class="collapsible-body">
          <a href="#" data-introStep="11">What are listings?</a>
          <a href="#" data-introStep="13">How do i add property listings?</a>
          <a href="#" data-introStep="14">Where are my saved properties?</a>
          <a href="#" data-introStep="15">What are Job posts?</a>
          <a href="#" data-introStep="16">What's a portfolio?</a>
      </div>
    </li>
  </ul>

</div>
</section>

<section class="_userPfPageModals">
  <div id="e-profile-Modal" class="modal">
        <div class="ed_profile_cont">
          <div class="ed_profile_row">
              <form id="userAccountForm_Flds_lajdu" autocomplete="off" class="user-pf-form" action="{% url 'profiles:edit_basic_profile' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="u-pf-details">
                  <div class="upf-header">
                    <h5>Update your account details</h5>
                    <button type="button" class="modal-close">
                      <span class="material-icons">close</span>
                    </button>
                  </div>
                  <div class="upf-fieldWrappers row">
                    <div class="upf-start-box col s12">
                        <div class="upf-profile_image">
                          {% if basic_form.instance.profile_image %}
                            <img id="__currentPImg" class="__currentPImg" src="{{basic_form.instance.profile_image.url}}" alt="{{user.username}}" style="width:150px;height:150px;object-fit:cover;">
                          {% else %}
                            <img id="__currentPImg" class="__currentPImg" src="{%static 'img/avatar.png'%}" alt="{{user.username}}" style="width:150px;height:150px;object-fit:cover;">
                          {% endif %}
                          <div id="upfPhotoInputSelector" class="upf-profile_imageSlt">
                            {{basic_form.profile_image}}
                          </div>
                          <div id="__selectedImageWrp">
                            <img id="__selectedImage" src="" alt="New Image">
                          </div>
                          {{basic_form.x}}
                          {{basic_form.y}}
                          {{basic_form.width}}
                          {{basic_form.height}}
                        </div>
                        <div class="upf-username">
                          <p>Your username</p>
                          {{basic_form.username}}
                        </div>
                        <div class="upf-first_name">
                          <p>Your first name</p>
                          {{basic_form.first_name}}
                        </div>
                        <div class="upf-last_name">
                          <p>Your last name</p>
                          {{basic_form.last_name}}
                        </div>
                        <div class="upf-email">
                          <p>Your email</p>
                          {{basic_form.email}}
                        </div>
                    </div>
                  </div>
                </div>
                <div class="s-prof">
                    <button id="updatePageProfile" type="submit" name="button">
                      <img src="{% static 'img/ajax-loader.gif'%}" alt="Saving">
                      Save
                    </button>
                </div>
              </form>
          </div>

        </div>
  </div>

  <div id="c-portfolio-Modal" class="modal">
    <div class="c-portfolio-helper">
      <div class="upf-header">
        <h5>Showcase your best work</h5>
        <button type="button" class="modal-close">
          <span class="material-icons">close</span>
        </button>
      </div>
        <div class="c-portfolio-hp-t">
                Your portfolio is where your most creative and skillfull work lives.<br> Create projects
                for just about anything and show potential clients you are the right person
                they are looking for.
               <br>
               <br>
               <a href="{% url 'profiles:portfolio_item_create'%}">
                 <button type="button" name="button">
                     Add Project
                 </button>
               </a>
        </div>

    </div>
  </div>
</section>

<div id="cropEditorModal" class="prfEditMode-cropModal closed">
  <div class="prfEMod-cropEditorModalContent">
      <div class="prfEMod-cropEditHead">
          <h2>Crop to fit your picture <br><span>( Scroll to zoom )</span></h2>
      </div>
      <div class="prfEMod-cropEditBody">
            <img id="prfEMod-crop-tg-image" src="" style="max-width: 100%;">
      </div>
      <div class="prfEMod-cropEditFooter">
        <button id="prfEMod-photoEditDone" type="button" name="button">Done</button>
      </div>
  </div>
</div>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script>

$(document).ready(function(){
  //page guide
    var intro = introJs().setOptions({
    tooltipClass: 'customTooltip',
    disableInteraction: true,
    steps: [
      {
        title: 'Welcome!',
        intro: "<img src='"+ "{% static 'img/guideData.svg'%}" + "' alt='welcome'> <br> Lets take you on a quick tour of this page."
      },
      {
        title: 'A quick note!',
        intro: "If you meet a feature on this tutorial that you can't see on your page, it means your account type is not allowed to access it. <br><br>However since this is a feature know how tutorial all features are mentioned. "
      },
      {
        element: document.querySelector('.tourStep1'),
        title: 'Page Navigation',
        intro: "<img src='" + "{% static 'img/guideWindows.svg'%}" +"' alt='Navbar'> <br> This section allows you to switch sections on this page or to go to other pages."
      },
      {
        element: document.querySelector('.tourStep2'),
        title: 'Main homepage',
        intro: 'Exit to rehgien.com'
      },
      {
        element: document.querySelector('.tourStep3'),
        title: 'Account section',
        intro: 'Manage all your account information in the account section. This is the default open tab.'
      },

      {
        element: document.querySelector('.tourStep6'),
        title: 'Notifications',
        intro: 'Any activity based and in-app notifications you have are shown and can be managed from here.',
        position: 'left'
      },
      {
        element: document.querySelector('.tourStep7'),
        title: 'Personal profile.',
        intro: "Your personal profile holds your identity on rehgien. <br>Update it anytime by clicking update account."
      },
      {
        element: document.querySelector('.tourStep8'),
        title: 'Business profile - <span>PRO feature</span>',
        intro: "As a PRO your business page and the information you give is critical to helping us connect you with new clients. <br> Therefore, make sure the information you provide is correct, complete and up to date!<br><br> If you are a pro please: <br> <a href='"+ "{% url 'rehgien_pro:ProSetupWizardView' %}" +"' target='_blank'>upgrade.</a>"
      },
      {
        element: document.querySelector('.tourStep9'),
        title: 'Connections - <span>PRO feature</span>',
        intro:"View and manage your connections on rehgien. Connecting with other pros on Rehgien increases your business page visibility and credibility. <br> <b>Only connect " +
        "with brands or pros you trust.</b> <br><br> If you are a pro please: <br> <a href='"+ "{% url 'rehgien_pro:ProSetupWizardView' %}" +"' target='_blank'>upgrade.</a>"
      },
      {
        element: document.querySelector('.tourStep10'),
        title: 'Account:Followers/ing.',
        intro: "If you are a pro you can manage the people you follow and people who follow you. If you are a CLIENT you can only follow pros but cannot have followers."
      },
      {
        element: document.querySelector('.tourStep4'),
        title: 'Listings section',
        intro: "<img src='" + "{% static 'img/guideSpreadsheet.svg'%}" +"' alt='Listings'> <br> Listings comprise of items you can post and interact with on rehgien."
      },

      {
        element: document.querySelector('.tourStep11'),
        title: 'Listings tabs',
        intro: "Quickly switch between open and closed tabs by clicking on this links.",
        position: 'left'
      },
      {
        element: document.querySelector('.tourStep12'),
        title: 'Property posts - <span>PRO feature</span>',
        intro: "<img src='" + "{% static 'img/guideHouseSelect.svg'%}" +"' alt='Listings'> <br> Post for free your properties and start getting clients. We give you dynamic statistical reports on the perfomance of each of your properties on rehgien . Feature only availlable to Real estate pros. <br><br> If you are a pro please: <br> <a href='"+ "{% url 'rehgien_pro:ProSetupWizardView' %}" +"' target='_blank'>upgrade.</a>"
      },
      {
        element: document.querySelector('.tourStep13'),
        title: 'Saved property',
        intro: "Quickly access and manage properties you have liked.",
        position: 'left'
      },
      {
        element: document.querySelector('.tourStep14'),
        title: 'Post a job',
        intro: "<img src='" + "{% static 'img/guidePeopleSearch.svg'%}" +"' alt='Listings'> <br> Jobs are an alternative and quick way to finding pros for a service you need, <a href='"+ "{% url 'markets:job_post_home' %}" +"' target='_blank'>learn more here.</a> <br><br>If you are a pro please: <br> <a href='"+ "{% url 'rehgien_pro:ProSetupWizardView' %}" +"' target='_blank'>upgrade</a> <br>in order to reply to jobs.",
        position: 'left'
      },
      {
        element: document.querySelector('.tourStep15'),
        title: 'Portfolio - <span>PRO feature</span> ',
        intro: "<img src='" + "{% static 'img/guidePortfolio.svg'%}" +"' alt='Listings'> <br> Showcase your work by posting any ongoing projects.<br> Projects form your portfolio and are shown on your business page. <br><br> If you are a pro please: <br> <a href='"+ "{% url 'rehgien_pro:ProSetupWizardView' %}" +"' target='_blank'>upgrade.</a>",
        position: 'left'
      },
      {
        element: document.querySelector('.tourStep5'),
        title: 'Pro homepage',
        intro: 'Explore a collection of tools meant to help your business grow'
        },
      {
          element: document.querySelector('.tourStep18'),
          title: 'Done!',
          intro: "Great you're good to go. We are always here if you need any help."
        },
    ]
    });
    introJs().refresh();

    var firstGuideOpen = true;
    $('#introStepMap a').on('click', function(){
          var num = $(this).attr('data-introStep');
          $('#introStepMap').css('right','-1000px');
          if (firstGuideOpen) {
            intro.goToStepNumber(parseInt(num)).start();
            firstGuideOpen = false;
          }else{
            intro.goToStepNumber(parseInt(num)-1).start();
          }

    })

    intro.onchange(function(targetElement) {
      var elData = $('#'+targetElement.id).attr('data-sc')
      if (elData === 'Listings'){
        document.getElementById("lstSct").click();
      }else if (elData === 'Accounts'){
        document.getElementById("defaultOpen").click();
      }
    });


    $('#showMapTour').on('click', function(){
      var tourWrapper= $('#introStepMap');
      if (tourWrapper.css('right') != '0px') {
        tourWrapper.css('right','0px');
      }else{
        tourWrapper.css('right','-1000px');
      }
    })

});

function openPage(event,pageName) {
  var i, dashboardTabContent, dashboardTabLinks;
  dashboardTabContent = document.getElementsByClassName("_dashboardTabContent");
  for (i = 0; i < dashboardTabContent.length; i++) {
    dashboardTabContent[i].style.display = "none";
  }
  dashboardTabLinks = document.getElementsByClassName("dashboardTabLink");
  for (i = 0; i < dashboardTabLinks.length; i++) {
    dashboardTabLinks[i].className = dashboardTabLinks[i].className.replace(" active", "");
  }
  document.getElementById(pageName).style.display = "block";
   event.currentTarget.className += " active";
}
// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();

var bsProfilePercentComplete = {% if user.user_type == 'PRO'%}{{user.pro_business_profile.percentage_complete}}{% else %}0{% endif %};

{% if user.user_type == 'PRO'%}
function showBsProfileProgress(){
  var bar = new ProgressBar.Circle(_bspProgress, {
    strokeWidth: 7,
    easing: 'easeInOut',
    duration: 1400,
    color: 'rgb(44 178 234 / 90%)',
    trailColor: 'rgb(44 178 234 / 40%)',
    trailWidth: 7,
    svgStyle: null
  });

  bar.animate(bsProfilePercentComplete/100,{
    duration: 3500
  }); // Number from 0.0 to 1.0
};
showBsProfileProgress();
{% endif %}

$(document).ready(function(){

  var loaderImg = $('#updatePageProfile img');
      loaderImg.hide();

  $('#userAccountForm_Flds_lajdu').on('submit', function(event){
     event.preventDefault();
     var formData = new FormData(this);

     loaderImg.show();
     var saveBtn = $('#updatePageProfile');
      saveBtn.attr('disabled', 'disabled');
      saveBtn.css({'background': '#fff', 'color':'#eee'});

     $.ajax({
       type : $(this).attr('method'),
       url : $(this).attr('action'),
       data :formData,
       cache: false,
       contentType: false,
       processData: false,
       // success
       success: function(response) {
          $('#kdaIPOb_OXpimg').html(response['ac_details']);
          $('#acctGreet_odsyb').html(response['ac_greet']);
          $('#_PcntComplSc_opsnc').html(response['profile_completion']);

          $('#__selectedImageWrp')
            .css('display','none');

          $('#__currentPImg')
            .attr('src', $("#upfSelectedPhoto-udf img").attr('src'))

            let msgBody;
            if (response['success'] != undefined ) {
             msgBody = $('#upfPageAcScs');
             msgBody.html("<span class='material-icons'>check_circle_outline</span>" + response['success'])
             msgBody.css({'display':'flex', 'z-index':'1003'});
           }else {
             msgBody = $('#upfPageAcErr');
             msgBody.html("<span class='material-icons'>error_outline</span>" + response['error']);
             msgBody.css({'display':'flex', 'z-index':'1003'});
           };

           setTimeout(function(){
              msgBody.css('display', 'none');
           }, 6000);

         loaderImg.hide();
         saveBtn.removeAttr('disabled');
         saveBtn.css({'background': '#eee', 'color':'#000'});

       },
       error: function(response,e){
         $('#upfPageAcErr').html("<span class='material-icons'>error_outline</span>" + 'Something went wrong. Try again later');

         $('#upfPageAcErr').css('display', 'flex');
         setTimeout(function(){
            $('#_epPaImg_reponse_msg_err').css({'display':'flex', 'z-index':'1003'});
         }, 6000);

         loaderImg.hide();
         saveBtn.removeAttr('disabled');
         saveBtn.css({'background': '#eee', 'color':'#000'});

       },
     });
  });

//   $('#id_profile_image').change(function () {
//   if ($(this)[0].files && $(this)[0].files[0]) {
//     var reader = new FileReader();
//     reader.onload = function (e) {
//       $('#__selectedImage')
//         .attr('src', e.target.result)
//         .width(70)
//         .height(70)
//         .css('object-fit','cover');
//
//       $('#__selectedImageWrp')
//       .css('display','flex');
//     };
//     reader.readAsDataURL($(this)[0].files[0]);
//   };
//
// });

$("#upfPhotoInputSelector input").change(function () {
    if (this.files && this.files[0]) {
      var reader = new FileReader();
      reader.onload = function (e) {
        $('#__selectedImage')
          .attr('src', e.target.result)
          .width(70)
          .height(70);
        $('#__selectedImageWrp')
        .css('display','flex');

        $("#prfEMod-crop-tg-image").attr("src", e.target.result);
        $("#cropEditorModal").removeClass("closed").trigger('modalOpen');
      }
      reader.readAsDataURL(this.files[0]);
    }
  });

  $('#prfEMod-photoEditDone').on('click', function(e){
    e.preventDefault()
    $('#cropEditorModal').addClass("closed").trigger('modalClosed');
  })

  var cropBoxData ;
  var canvasData ;
  let crpImg = $('#prfEMod-crop-tg-image');
  $('#cropEditorModal').on('modalOpen', function(){
    $('#prfEMod-crop-tg-image').cropper({
        viewMode: 1,
        dragMode:'move',
        aspectRatio: 1/1,
        cropBoxResizable:false,
        cropBoxMovable: true,
        toggleDragModeOnDblclick:false,
        minCropBoxWidth: 200,
        minCropBoxHeight: 200,
        data:{
          width: 200,
          height: 200,
        },
        ready: function () {
          crpImg.cropper("setCanvasData", canvasData);
          crpImg.cropper("setCropBoxData", cropBoxData);
        },
      });

  }).on("modalClosed", function () {
      cropBoxData = crpImg.cropper("getCropBoxData");
      canvasData = crpImg.cropper("getCanvasData");
      canvas = crpImg.cropper("getCroppedCanvas", {
                          width: 200,
                          height: 200,
                          imageSmoothingEnabled:true,
                          });
      var cropData = crpImg.cropper("getData");
      crpImg.cropper("destroy");
      $("#__selectedImageWrp").html(canvas);

      $("#id_x").val(cropData["x"]);
      $("#id_y").val(cropData["y"]);
      $("#id_height").val(cropData["height"]);
      $("#id_width").val(cropData["width"]);
    });

  $(document).on('click', '._removeSavedlsUpf', function(){
        var savedProperty = $(this);
        var pk = savedProperty.attr('data-propertypk')
        var rowID = $('#_isSavedLsUpf_id_' + pk )
        var successmsgBody = $('#upfPageAcScs')
        var errmsgBody = $('#upfPageAcScs')

        $.ajax({
            type: "POST",
            url: "{% url 'listings:save_property'%}",
            data: {
                'pk': pk,
                'property_category':'homes',
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function (responseData) {
                rowID.css('display','none')
                successmsgBody.html("<span class='material-icons'>check_circle_outline</span>" + 'Successfully removed home from saved!')
                successmsgBody.css('display', 'flex')
                setTimeout(function(){
                   successmsgBody.css('display', 'none');
                }, 6000);
            },
            error: function(rs,e){
              errmsgBody.html("<span class='material-icons'>error_outline</span>" + 'Something went wrong unable to unsave property!')
              errmsgBody.css('display', 'flex')
              setTimeout(function(){
                 errmsgBody.css('display', 'none');
              }, 6000);
            },
      });
  });

//

  $('#upNav-control').on('click', function(){
    let lNav = $('#acct_left_navg');
    let rCon = $('#acct_right_content');
    let lPtx = $('#AcsNavLinks p');
    let lacTg = $('#AcsNavLinks a');
    let lacTgActive = $('#AcsNavLinks a.active');
    let lNavPimage = $('#kdaIPOb_OXpimg');
   if (lNav.attr('data-isOpen') === 'True') {
     lNav.css('width','5%');
     rCon.css('width','95%');
     lPtx.css('display','none');
     lNavPimage.css('display','none');
     lacTg.addClass('navIsOpen');
     lNav.attr('data-isOpen','False');
   }else{
     lNav.css('width','18%');
     lPtx.css('display','block');
     lNavPimage.css('display','block')
     lacTg.removeClass('navIsOpen');
     rCon.css('width','82%');
     lNav.attr('data-isOpen','True');
   }
});

})
</script>

{% endblock %}
